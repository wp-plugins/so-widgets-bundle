var sowEmitters={_match:function(e,i){"undefined"==typeof i&&(i=".*");var t=new RegExp("^([a-zA-Z0-9_-]+)(\\[([a-zA-Z0-9_-]+)\\])? *: *("+i+") *$"),n=t.exec(e);if(null===n)return!1;var a="",r="default";return void 0!==n[3]?(r=n[1],a=n[3]):a=n[1],{match:n[4].trim(),group:r,state:a}},_checker:function(e,i,t,n){var a={};"undefined"==typeof i.length&&(i=[i]);for(var r,o=0;o<i.length;o++)r=sowEmitters._match(i[o],t),r!==!1&&("_true"===r.match||n(e,i,r.match))&&(a[r.group]=r.state);return a},select:function(e,i){"undefined"==typeof i.length&&(i=[i]);for(var t={},n=0;n<i.length;n++)""===i[n]&&(i[n]="default"),t[i[n]]=e;return t},conditional:function(val,args){return sowEmitters._checker(val,args,"[^;{}]*",function(val,args,match){return eval(match)})},"in":function(e,i){return sowEmitters._checker(e,i,"[^;{}]*",function(e,i,t){return-1!==t.split(",").map(function(e){return e.trim()}).indexOf(e)})}};!function(e){e.fn.sowSetupForm=function(){return e(this).each(function(i,t){var n,a=e(t),r=!0,o=a.find("input[name]");if(o.length&&-1!==o.attr("name").indexOf("__i__"))return this;if(a.is(".siteorigin-widget-form-main")){if(a.data("sow-form-setup")===!0)return!0;if(e("body").hasClass("widgets-php")&&!a.is(":visible")&&0===a.closest(".panel-dialog").length)return!0;a.on("sowstatechange",function(i,t,n){a.find("[data-state-handler]").each(function(){var i=e(this),a=e.extend({},i.data("state-handler"),r?i.data("state-handler-initial"):{});if(0===Object.keys(a).length)return!0;var o,s,d,l,f,c={};for(var g in a)if(f=!1,o=g.match(/^([a-zA-Z0-9_-]+)(\[([a-zA-Z0-9_-]+)\])?(\[\])?$/),null!==o&&(s={group:"default",name:"",multi:!1},void 0!==o[2]?(s.group=o[1],s.name=o[3]):s.name=o[0],s.multi=void 0!==o[4],"_else"===s.group?(s.group=s.name,s.name="",f="undefined"==typeof c[s.group]):f=s.group===t&&s.name===n,f)){d=a[g],s.multi||(d=[d]);for(var u=0;u<d.length;u++)l="undefined"!=typeof d[u][1]&&Boolean(d[u][1])?i.find(d[u][1]):i,l[d[u][0]].apply(l,"undefined"!=typeof d[u][2]?d[u][2]:[]);c[s.group]=!0}})}),a.sowSetupPreview(),n=a}else n=a.closest(".siteorigin-widget-form-main");var s=a.find("> .siteorigin-widget-field");s.find("> .siteorigin-widget-section").sowSetupForm(),s.find(".siteorigin-widget-input").each(function(i,t){null===e(t).data("original-name")&&e(t).data("original-name",e(t).attr("name"))}),s.find("> .siteorigin-widget-field-repeater").sowSetupRepeater(),a.find(".siteorigin-widget-field-repeater-item").sowSetupRepeaterItems(),s.find("> .siteorigin-widget-input-color").wpColorPicker().closest(".siteorigin-widget-field").find("a").click(function(){"undefined"!=typeof e.fn.dialog&&e(this).closest(".panel-dialog").dialog("option","position","center")}),s.find("> .media-field-wrapper").each(function(){var i=e(this),t=i.closest(".siteorigin-widget-field");i.find("a.media-upload-button").click(function(i){if("undefined"!=typeof wp.media){var n=e(this),a=e(this).closest(".siteorigin-widget-field"),r=e(this).data("frame");return r?(r.open(),!1):(r=wp.media({title:n.data("choose"),library:{type:n.data("library").split(",").map(function(e){return e.trim()})},button:{text:n.data("update"),close:!1}}),n.data("frame",r),r.on("select",function(){var e=r.state().get("selection").first().attributes;a.find(".current .title").html(e.title);var i=a.find("input[type=hidden]");i.val(e.id),i.trigger("change"),"undefined"!=typeof e.sizes?"undefined"!=typeof e.sizes.thumbnail?a.find(".current .thumbnail").attr("src",e.sizes.thumbnail.url).fadeIn():a.find(".current .thumbnail").attr("src",e.sizes.full.url).fadeIn():a.find(".current .thumbnail").attr("src",e.icon).fadeIn(),t.find(".media-remove-button").removeClass("remove-hide"),r.close()}),r.open(),!1)}}),i.find(".current").mouseenter(function(){var i=e(this).find(".title");""!==i.html()&&i.fadeIn("fast")}).mouseleave(function(){e(this).find(".title").clearQueue().fadeOut("fast")}),t.find("a.media-remove-button").click(function(i){i.preventDefault(),t.find(".current .title").html(""),t.find("input[type=hidden]").val(""),t.find(".current .thumbnail").fadeOut("fast"),e(this).addClass("remove-hide")})}),s.filter(".siteorigin-widget-field-type-widget, .siteorigin-widget-field-type-section").find("> label").click(function(){e(this);e(this).toggleClass("siteorigin-widget-section-visible"),e(this).siblings(".siteorigin-widget-section").slideToggle(function(){"undefined"!=typeof e.fn.dialog&&e(this).closest(".panel-dialog").dialog("option","position","center"),e(window).resize()})});var d={};s.find("> .siteorigin-widget-icon-selector").each(function(){var i=e(this),t=i.find(".siteorigin-widget-icon-icon"),n=function(){var n=i.find("select.siteorigin-widget-icon-family").val(),a=i.find(".siteorigin-widget-icon-icons");if("undefined"!=typeof d[n]){a.empty(),0===e("#siteorigin-widget-font-"+n).length&&e("<link rel='stylesheet' type='text/css'>").attr("id","siteorigin-widget-font-"+n).attr("href",d[n].style_uri).appendTo("head");for(var r in d[n].icons){var o=e('<div data-sow-icon="'+d[n].icons[r]+'"/>').attr("data-value",n+"-"+r).addClass("sow-icon-"+n).addClass("siteorigin-widget-icon-icons-icon").click(function(){var i=e(this);i.hasClass("siteorigin-widget-active")?(i.removeClass("siteorigin-widget-active"),t.val("")):(a.find(".siteorigin-widget-icon-icons-icon").removeClass("siteorigin-widget-active"),i.addClass("siteorigin-widget-active"),t.val(e(this).data("value"))),t.trigger("change")});t.val()===n+"-"+r&&o.addClass("siteorigin-widget-active"),a.append(o)}a.prepend(a.find(".siteorigin-widget-active"))}},a=function(){var t=i.find("select.siteorigin-widget-icon-family").val();"undefined"!=typeof t&&""!==t&&("undefined"==typeof d[t]?e.getJSON(soWidgets.ajaxurl,{action:"siteorigin_widgets_get_icons",family:i.find("select.siteorigin-widget-icon-family").val()},function(e){d[t]=e,n()}):n())};a(),i.find("select.siteorigin-widget-icon-family").change(function(){i.find(".siteorigin-widget-icon-icons").empty(),a()})}),s.filter(".siteorigin-widget-field-type-slider").each(function(){var i=e(this),t=i.find('input[type="number"]'),n=i.find(".siteorigin-widget-value-slider");n.slider({max:parseInt(t.attr("max")),min:parseInt(t.attr("min")),value:parseInt(t.val()),slide:function(e,n){t.val(parseInt(n.value)),i.find(".siteorigin-widget-slider-value").html(n.value)}})}),s.filter(".siteorigin-widget-field-type-link").each(function(){var i=e(this),t=null,n=function(){null!==t&&t.abort();var n=i.find(".content-text-search").val(),a=i.find("ul.posts").empty().addClass("loading");e.get(soWidgets.ajaxurl,{action:"so_widgets_search_posts",query:n},function(i){for(var t=0;t<i.length;t++)a.append(e("<li>").addClass("post").html(i[t].post_title+"<span>("+i[t].post_type+")</span>").data(i[t]));a.removeClass("loading")})};i.find(".select-content-button, .button-close").click(function(t){t.preventDefault(),e(this).blur();var a=i.find(".existing-content-selector");a.toggle(),a.is(":visible")&&0===a.find("ul.posts li").length&&n()}),i.on("click",".posts li",function(t){t.preventDefault();var n=e(this);i.find("input.siteorigin-widget-input").val("post: "+n.data("ID")),i.find(".existing-content-selector").toggle()});var a=null;i.find(".content-text-search").keyup(function(){null!==a&&clearTimeout(a),a=setTimeout(function(){n()},500)})});var l=function(){var i=e(this),t=i.closest("[data-state-emitter]").data("state-emitter");if("undefined"!=typeof t){var a=function(t,n){return"undefined"==typeof sowEmitters[t.callback]||"_"===t.callback.substr(0,1)?n:e.extend(n,sowEmitters[t.callback](i.val(),t.args))},r={"default":""};"undefined"==typeof t.length&&(t=[t]);for(var o=0;o<t.length;o++)r=a(t[o],r);var s=n.data("states");"undefined"==typeof s&&(s={"default":""});for(var d in r)("undefined"==typeof s[d]||r[d]!==s[d])&&(s[d]=r[d],n.trigger("sowstatechange",[d,r[d]]));n.data("states",s)}};s.filter("[data-state-emitter]").each(function(){e(this).find(".siteorigin-widget-input").on("keyup change",l),e(this).find(".siteorigin-widget-input").each(function(){var i=e(this);i.is(":radio")?i.is(":checked")&&l.call(i[0]):l.call(i[0])})}),a.trigger("sowsetupform",s).data("sow-form-setup",!0),a.find(".siteorigin-widget-field-repeater-item").trigger("updateFieldPositions"),r=!1})},e.fn.sowSetupPreview=function(){var i=e(this),t=i.siblings(".siteorigin-widget-preview");t.find("> a").click(function(t){t.preventDefault();var n={};i.find("*[name]").each(function(){var i=e(this),t=/[a-zA-Z0-9\-]+\[[a-zA-Z0-9]+\]\[(.*)\]/.exec(i.attr("name"));t=t[1];var a=t.split("][");a=a.map(function(e){return!isNaN(parseFloat(e))&&isFinite(e)?parseInt(e):e});for(var r=n,o=0;o<a.length;o++)o===a.length-1?"checkbox"===i.attr("type")?r[a[o]]=i.is(":checked")?""!==i.val()?i.val():!0:!1:"radio"===i.attr("type")?i.is(":checked")&&(r[a[o]]=""!==i.val()?i.val():!0):r[a[o]]=i.val():("undefined"==typeof r[a[o]]&&(r[a[o]]={}),r=r[a[o]])});var a=e(e("#so-widgets-bundle-tpl-preview-dialog").html().trim()).appendTo("body");a.find('input[name="data"]').val(JSON.stringify(n)),a.find('input[name="class"]').val(i.data("class")),a.find("iframe").on("load",function(){e(this).css("visibility","visible")}),a.find("form").submit(),a.find(".close").click(function(){a.remove()})})},e.fn.sowSetupRepeater=function(){return e(this).each(function(i,t){var n=e(t),a=n.find(".siteorigin-widget-field-repeater-items"),r=n.data("repeater-name");a.bind("updateFieldPositions",function(){var i=e(this),t=i.find("> .siteorigin-widget-field-repeater-item");t.each(function(i,t){e(t).find(".siteorigin-widget-input").each(function(t,n){var a=e(n).data("repeater-positions");"undefined"==typeof a&&(a={}),a[r]=i,e(n).data("repeater-positions",a)})}),i.find(".siteorigin-widget-input").each(function(i,t){var n=e(t).data("repeater-positions"),a=e(t);if("undefined"!=typeof n){var r=a.data("original-name");if("undefined"==typeof r&&(a.data("original-name",a.attr("name")),r=a.attr("name")),!r)return;for(var o in n)r=r.replace("#"+o+"#",n[o]);e(t).attr("name",r)}});var a=n.data("scroll-count")?parseInt(n.data("scroll-count")):0;if(a>0&&t.length>a){var o=t.first().outerHeight();i.css("max-height",o*a).css("overflow","auto")}else i.css("max-height","").css("overflow","")}),a.sortable({handle:".siteorigin-widget-field-repeater-item-top",items:"> .siteorigin-widget-field-repeater-item",update:function(){a.trigger("updateFieldPositions")}}),a.trigger("updateFieldPositions"),n.find("> .siteorigin-widget-field-repeater-add").disableSelection().click(function(i){i.preventDefault(),n.closest(".siteorigin-widget-field-repeater").sowAddRepeaterItem().find("> .siteorigin-widget-field-repeater-items").slideDown("fast",function(){e(window).resize()}),"undefined"!=typeof e.fn.dialog&&e(this).closest(".panel-dialog").dialog("option","position","center")}),n.find("> .siteorigin-widget-field-repeater-top > .siteorigin-widget-field-repeater-expend").click(function(e){e.preventDefault(),n.closest(".siteorigin-widget-field-repeater").find("> .siteorigin-widget-field-repeater-items").slideToggle("fast")})})},e.fn.sowAddRepeaterItem=function(){return e(this).each(function(i,t){var n=e(t),a=n.find("> .siteorigin-widget-field-repeater-items").children().length+1,r=n.find("> .siteorigin-widget-field-repeatear-item-html").html().replace(/data-name="/g,'name="').replace(/_id_/g,a),o="undefined"!=typeof n.attr("readonly"),s=e('<div class="siteorigin-widget-field-repeater-item ui-draggable" />').append(e('<div class="siteorigin-widget-field-repeater-item-top" />').append(e('<div class="siteorigin-widget-field-expand" />')).append(o?"":e('<div class="siteorigin-widget-field-remove" />')).append(e("<h4 />").html(n.data("item-name")))).append(e('<div class="siteorigin-widget-field-repeater-item-form" />').html(r));n.find("> .siteorigin-widget-field-repeater-items").append(s).sortable("refresh").trigger("updateFieldPositions"),s.sowSetupRepeaterItems(),s.hide().slideDown("fast",function(){e(window).resize()})})},e.fn.sowRemoveRepeaterItem=function(){return e(this).each(function(i,t){var n=e(this).closest(".siteorigin-widget-field-repeater-items");e(this).remove(),n.sortable("refresh").trigger("updateFieldPositions")})},e.fn.sowSetupRepeaterItems=function(){return e(this).each(function(i,t){var n=e(t);if("undefined"==typeof n.data("sowrepeater-actions-setup")){var a=n.closest(".siteorigin-widget-field-repeater"),r=n.find("> .siteorigin-widget-field-repeater-item-top"),o=a.data("item-label");if(o&&o.selector){var s=function(){var e=o.hasOwnProperty("valueMethod")&&o.valueMethod?o.valueMethod:"val",i=n.find(o.selector)[e]();i&&(i.length>80&&(i=i.substr(0,79)+"..."),r.find("h4").text(i))};s();var d=o.hasOwnProperty("updateEvent")&&o.updateEvent?o.updateEvent:"change";n.bind(d,s)}r.click(function(i){"siteorigin-widget-field-remove"!==i.target.className&&(i.preventDefault(),e(this).closest(".siteorigin-widget-field-repeater-item").find(".siteorigin-widget-field-repeater-item-form").eq(0).slideToggle("fast",function(){"undefined"!=typeof e.fn.dialog&&e(this).closest(".panel-dialog").dialog("option","position","center"),e(this).trigger(e(this).is(":visible")?"slideToggleOpenComplete":"slideToggleCloseComplete")}))}),r.find(".siteorigin-widget-field-remove").click(function(i){if(i.preventDefault(),confirm(soWidgets.sure)){var t=e(this).closest(".siteorigin-widget-field-repeater-items");e(this).closest(".siteorigin-widget-field-repeater-item").slideUp("fast",function(){e(this).remove(),t.sortable("refresh").trigger("updateFieldPositions"),e(window).resize()})}}),n.find("> .siteorigin-widget-field-repeater-item-form").sowSetupForm(),n.data("sowrepeater-actions-setup",!0)}})},window.sowGetWidgetFieldVariable=function(e,i,t){var n=window.sow_field_javascript_variables[e];i=i.replace(/\[#.*?#\]/g,"");for(var a=/[a-zA-Z0-9\-]+(?:\[c?[0-9]+\])?\[(.*)\]/.exec(i)[1],r=a.split("]["),o=r.length?n:null;r.length;)o=o[r.shift()];return o[t]},window.sowFetchWidgetVariable=function(i,t,n){window.sowVars=window.sowVars||{},"undefined"==typeof window.sowVars[t]?e.post(soWidgets.ajaxurl,{action:"sow_get_javascript_variables",widget:t,key:i},function(e){window.sowVars[t]=e,n(window.sowVars[t][i])}):n(window.sowVars[t][i])},e(".widgets-holder-wrap").on("click",".widget:has(.siteorigin-widget-form-main) .widget-top",function(){var i=e(this).closest(".widget").find(".siteorigin-widget-form-main");setTimeout(function(){i.sowSetupForm()},200)}),e("body").hasClass("wp-customizer")&&e(document).on("widget-added",function(e,i){i.find(".siteorigin-widget-form").sowSetupForm()}),e(document).on("dialogopen",function(i){e(i.target).find(".siteorigin-widget-form-main").sowSetupForm()}),e(document).trigger("sowadminloaded")}(jQuery);